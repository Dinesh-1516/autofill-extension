let b=[];function $(e){const n=e instanceof HTMLInputElement&&(e.type==="checkbox"||e.type==="radio");if(n){const s=L(e);if(s)return s.replace(/[:\*]+$/,"").trim();const i=T(e);if(i)return i.replace(/[:\*]+$/,"").trim()}const o=I(e);if(o)return o.replace(/[:\*]+$/,"").trim();const t=e.getAttribute("aria-label");if(t)return t.replace(/[:\*]+$/,"").trim();if(!n){const s=L(e);if(s)return s.replace(/[:\*]+$/,"").trim();const i=T(e);if(i)return i.replace(/[:\*]+$/,"").trim()}const r=w(e);if(r.length>0&&r[0])return r[0].replace(/[:\*]+$/,"").trim();if("placeholder"in e&&e.placeholder)return e.placeholder.replace(/[:\*]+$/,"").trim();if(e.name)return e.name;if(e.id)return e.id;const l=P(e);return l?l.replace(/[:\*]+$/,"").trim():k(e)}function P(e){var r,l;let n=e,o=0;const t=5;for(;n&&o<t;){let s=n.previousElementSibling;for(;s;){if(s instanceof HTMLElement){if(s.tagName.match(/^H[1-6]$/)){const i=(r=s.textContent)==null?void 0:r.trim();if(i&&i.length<100)return i}if(s.classList.contains("heading")||s.classList.contains("section-title")||s.classList.contains("form-section")||s.hasAttribute("data-type")&&s.getAttribute("data-type")==="control_head"){const i=(l=s.textContent)==null?void 0:l.trim();if(i&&i.length<100)return i}}s=s.previousElementSibling}n=n.parentElement,o++}return null}function j(e){return e.hasAttribute("required")||e.getAttribute("aria-required")==="true"||e.classList.contains("required")}function W(e){const n=w(e);if(n.length===0)return $(e);const o=n.map(t=>t.replace(/[:\*]+$/,"").trim()).filter(t=>t.length>0);return o.length===0?$(e):o.reverse().join(" -> ")}function v(e,n,o){const t=k(e),r=$(e),l=W(e),s=j(e),i=b.findIndex(u=>u.SELECTOR===t),c={"FIELD NAME":r,"FULL LABEL PATH":l,REQUIRED:s,FILLED:n,FILLED_BY:o,SELECTOR:t};i>=0?b[i]=c:b.push(c)}function q(){console.log(`
üéØ ============ FIELD TRACKING SUMMARY ============`);const e=b.filter(t=>t.FILLED_BY==="fuzzy_match"),n=b.filter(t=>t.FILLED_BY==="ai_autofill"),o=b.filter(t=>t.FILLED_BY==="failed");return console.log(`
üìä Statistics:`),console.log(`   - Total fields tracked: ${b.length}`),console.log(`   - Fuzzy match filled: ${e.length}`),console.log(`   - AI autofill filled: ${n.length}`),console.log(`   - Failed fields: ${o.length}`),console.log(`
‚úÖ FUZZY MATCH FILLED:`),e.forEach((t,r)=>{console.log(`   ${r+1}. "${t["FIELD NAME"]}" - REQ: ${t.REQUIRED?"YES":"NO"}`)}),console.log(`
ü§ñ AI AUTOFILL FILLED:`),n.forEach((t,r)=>{console.log(`   ${r+1}. "${t["FIELD NAME"]}" - REQ: ${t.REQUIRED?"YES":"NO"}`)}),console.log(`
‚ùå FAILED FIELDS:`),o.forEach((t,r)=>{console.log(`   ${r+1}. "${t["FIELD NAME"]}" - REQ: ${t.REQUIRED?"YES":"NO"}`)}),console.log(`
üìã FULL TRACKING DATA:`),console.log(JSON.stringify(b,null,2)),console.log(`
============ END OF TRACKING SUMMARY ============
`),b}function B(){b=[]}function z(){document.querySelectorAll("input, textarea, select").forEach(n=>{if(n instanceof HTMLInputElement&&(n.type==="hidden"||n.type==="submit"||n.type==="button"))return;const o=k(n);if(!b.some(r=>r.SELECTOR===o)){let r=!1;n instanceof HTMLSelectElement?r=!n.value||n.value==="":n instanceof HTMLInputElement?n.type==="checkbox"||n.type==="radio"?r=!n.checked:n.type==="file"?r=!n.files||n.files.length===0:r=!n.value||n.value==="":r=!n.value||n.value==="",r&&v(n,!1,"failed")}})}function Y(e,n){const o=[];for(let t=0;t<=n.length;t++)o[t]=[t];for(let t=0;t<=e.length;t++)o[0][t]=t;for(let t=1;t<=n.length;t++)for(let r=1;r<=e.length;r++)n.charAt(t-1)===e.charAt(r-1)?o[t][r]=o[t-1][r-1]:o[t][r]=Math.min(o[t-1][r-1]+1,o[t][r-1]+1,o[t-1][r]+1);return o[n.length][e.length]}function N(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g,"").split(/\s+/).sort().join(" ").trim()}function A(e,n){const o=N(e),t=N(n),r=Math.max(o.length,t.length);return r===0?1:1-Y(o,t)/r}function m(e){return e.toLowerCase().trim().replace(/[^a-z0-9]/g,"")}function S(e){return e.toLowerCase().replace(/[^a-z0-9\s]/g," ").split(/[\s_\-\.]+/).filter(n=>n.length>0)}function O(e,n=""){const o=[];for(const t in e){const r=n?`${n}.${t}`:t;typeof e[t]=="object"&&e[t]!==null&&!Array.isArray(e[t])?(o.push(r),o.push(...O(e[t],r))):o.push(r)}return o}function w(e){const n=[];let o="";if(e.id){const l=document.querySelector(`label[for="${e.id}"]`);l!=null&&l.textContent&&(o=l.textContent)}if(!o){const l=e.closest("label");l!=null&&l.textContent&&(o=l.textContent)}!o&&"placeholder"in e&&e.placeholder&&(o=e.placeholder),!o&&e.name&&(o=e.name),!o&&e.getAttribute("aria-label")&&(o=e.getAttribute("aria-label")||""),o&&n.push(o);const t=e.closest(".form-line");if(t){const l=t.querySelector(".form-label");l!=null&&l.textContent&&l.textContent!==o&&n.push(l.textContent)}let r=e;for(;r;)if(r=r.parentElement,r!=null&&r.classList.contains("form-section")){const l=r.querySelector(".form-header");if(l!=null&&l.textContent){n.push(l.textContent);break}}return n}function G(e){var s;const n=[],o=w(e);n.push(...o);let t=e.parentElement,r=0;for(;t&&r<5;)Array.from(t.childNodes).filter(u=>{var f;return u.nodeType===Node.TEXT_NODE&&((f=u.textContent)==null?void 0:f.trim())}).forEach(u=>{var a;const f=(a=u.textContent)==null?void 0:a.trim();f&&f.length>3&&f.length<200&&n.push(f)}),t.querySelectorAll("p, span, div, h1, h2, h3, h4, h5, h6").forEach(u=>{var a;const f=(a=u.textContent)==null?void 0:a.trim();f&&f.length>5&&f.length<200&&(n.some(h=>m(h)===m(f))||n.push(f))}),t=t.parentElement,r++;const l=(s=e.parentElement)==null?void 0:s.children;return l&&Array.from(l).forEach(i=>{if(i!==e&&i.textContent){const c=i.textContent.trim();c.length>5&&c.length<200&&(n.some(u=>m(u)===m(c))||n.push(c))}}),e.accept&&n.push(`file_upload_${e.accept}`),e.id&&n.push(e.id),e.name&&n.push(e.name),n}function J(e){const n=m(e);return["resume","cv","upload","file","document","attach","drag","drop","pdf","doc","docx","browse"].some(t=>n.includes(t))}function V(e,n){const o={fullname:["name","completename","legalname"],firstname:["first","given","forename","fname","givenname"],lastname:["last","surname","family","lname","familyname"],middlename:["middle","mname","middleinitial"],email:["emailaddress","mail","e-mail","emailid"],phonenumber:["phone","mobile","telephone","contact","cell","cellphone","contactnumber","mobilenumber","telephonenumber"],alternatephone:["alternate","secondary","secondaryphone","alternatenumber","secondarynumber","homephone","otherphone"],addressstreet:["address","street","addressline1","address1","streetaddress","line1"],addressline2:["address2","apartment","apt","suite","unit","line2"],addresscity:["city","town","locality"],addressstate:["state","province","region","county","stateprovince"],addresspostalcode:["zip","zipcode","postal","postcode","postalcode"],addresscountry:["country","nation"],dateofbirth:["dob","birthdate","birthday","birth","bdate"],dateofbirthday:["day","dd","dobday","birthd ay","dateday","birthdateday"],dateofbirthmonth:["month","mm","dobmonth","birthmonth","datemonth","birthdatemonth"],dateofbirthyear:["year","yyyy","dobyear","birthyear","dateyear","birthdateyear"],gender:["sex"],maritalstatus:["marital","status"],nationality:["nation","countryofbirth"],citizenship:["citizen","citizenstatus","countryofcitizenship"],educationhighschoolname:["highschool","school","schoolname","secondaryschool","highschoolname"],educationhighschoollevel:["educationlevel","level","qualification"],educationhighschoolstartyear:["schoolstart","schoolstartyear","highschoolstart"],educationhighschoolendyear:["schoolend","schoolendyear","highschoolend","graduationyear","graduation"],educationhighschoolgpa:["schoolgpa","highschoolgpa","gpa","grade","grades"],educationcollegename:["college","university","collegename","universityname","institution","uni","school"],educationcollegedegree:["degree","degreetype","qualification","certification"],educationcollegemajor:["major","fieldofstudy","field","concentration","specialization","subject","course"],educationcollegestartyear:["collegestart","universitystart","degreestart"],educationcollegeendyear:["collegeend","universityend","degreeend","expectedgraduation","graduation"],educationcollegegpa:["collegegpa","universitygpa","gpa","grade","cgpa"],workpositiontitle:["jobtitle","position","title","role","job","positiontitle","designation"],workcompanyname:["company","employer","organization","companyname","employername","workplace","firm"],worklocation:["location","joblocation","workplace","city"],workemploymenttype:["employmenttype","jobtype","type","worktype"],workstartmonth:["startmonth","frommonth","beginmonth"],workstartyear:["startyear","fromyear","beginyear"],workendmonth:["endmonth","tomonth","untilmonth"],workendyear:["endyear","toyear","untilyear"],workcurrentlyemployed:["currentlyworking","currentjob","present","currentlyemployed","stillempl oyed"],workdescription:["description","jobdescription","responsibilities","duties","role","experience"],referencename:["reference","refereename","referee","referral","referenceperson"],referencerelationship:["relationship","relation"],referencephone:["referencephone","refereephon e","referencecontact"],referenceemail:["referenceemail","refereemail"],employmentnoticeperiod:["noticeperiod","notice","noticetime"],employmentpreferredlocation:["preferredlocation","desiredlocation","location","preferredcity"],employmentcurrentlocation:["currentlocation","location","city"],employmentwillingtorelocate:["relocate","willingtorelocate","relocation","canrelocate"],employmentenglishproficiency:["english","englishproficiency","englishlevel","language"],employmentexpectedsalary:["salary","expectedsalary","salaryexpectation","desiredsalary","compensation","pay","wage"],employmentavailabledays:["availabledays","workdays","days"],employmentavailablehours:["availablehours","workhours","hours","availability"],employmentauthorizedus:["authorizedus","usauthorization","usworkauthorization","uswork"],employmentauthorizeduk:["authorizeduk","ukauthorization","ukworkauthorization"],employmentauthorizedcanada:["authorizedcanada","canadaauthorization"],employmentvisastatus:["visa","visastatus","workpermit","authorization"],eeodisability:["disability","disabilitystatus","disabled"],eeogenderidentity:["genderidentity","gender"],eeosexualorientation:["sexualorientation","orientation"],eeoveteranstatus:["veteran","veteranstatus","military"],eeominoritygroup:["minority","minoritygroup","race","ethnicity"],eeoethnicity:["ethnicity","race","racialbackground"],resume:["cv","resumefile","cvfile","curriculum","curriculumvitae"],cv:["resume","cvfile","resumefile"],portfolio:["website","portfoliourl","portfoliowebsite","personalwebsite"],linkedin:["linkedinurl","linkedinprofile","linkedin-url"],github:["githuburl","githubprofile","github-url","git"]};if(e===n)return 1;for(const[t,r]of Object.entries(o)){if(e===t&&r.includes(n)||n===t&&r.includes(e))return .98;if(r.includes(e)&&r.includes(n))return .95}return 0}function _(e,n){if(e.length===0||n.length===0)return 0;let o=0;for(const l of e)n.includes(l)&&o++;const t=o/e.length,r=o/n.length;return t>=.8&&r>=.5?Math.max(t,r):0}function Z(e,n){const o=m(n),t=S(n),r=[];for(const c of e){const f=S(c).filter(a=>!["section","form","information","details","personal","please","enter","provide"].includes(a));r.push(...f)}const l=Array.from(new Set(r));let s=0;for(const c of l)(t.includes(c)||o.includes(c))&&s++;return l.length===0?0:s/l.length>=.6?.85:0}function Q(e,n,o,t){if(e.includes(n)||n.includes(e))return Math.min(e.length,n.length)/Math.max(e.length,n.length)*.85;for(const r of o)for(const l of t)if((r.includes(l)||l.includes(r))&&r.length>=4&&l.length>=4)return .75;return 0}function K(e,n,o){const t=m(e),r=S(e);let l=0,s=0,i="fuzzy";for(let u=0;u<n.length;u++){const f=n[u],a=m(f);if(!a)continue;const h=o[u]||.1;s+=h;const p=S(f);if(a===t){l+=1*h,i="exact";continue}const d=V(a,t);if(d>.9){l+=d*h,i==="fuzzy"&&(i="alias");continue}const g=_(p,r);if(g>.8){l+=g*h;continue}if(u>0){const x=Z(n.slice(0,u+1),e);if(x>.8){l+=x*h;continue}}const y=Q(a,t,p,r);if(y>.7){l+=y*h;continue}const E=A(a,t);l+=E*h}return{score:s>0?l/s:0,matchType:i}}function C(e,n,o=.8){if(e.length===0)return null;const t=O(n);let r=null;const l=[1,.3,.1];for(const s of t){const i=K(s,e,l);i.score>o&&(!r||i.score>r.score)&&(r={key:s,score:i.score,matchType:i.matchType})}return r}function X(e,n){return e.value=n,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("blur",{bubbles:!0})),e.dispatchEvent(new KeyboardEvent("keyup",{bubbles:!0})),!0}function ee(e,n){const o=m(n),t=S(n);let r=null;for(let l=0;l<e.options.length;l++){const s=e.options[l],i=m(s.textContent||""),c=m(s.value),u=S(s.textContent||"");let f=0,a="none";if(i===o||c===o)f=1,a="exact";else if(i.includes(o)||o.includes(i)||c.includes(o)||o.includes(c))f=.85,a="contains";else{const h=_(t,u);if(h>.7)f=h,a="multiword";else{const p=A(o,i),d=A(o,c);f=Math.max(p,d),a="fuzzy"}}f>.7&&(!r||f>r.score)&&(r={index:l,score:f,matchType:a})}return r&&r.score>.7?(e.selectedIndex=r.index,e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("blur",{bubbles:!0})),console.log(`‚úÖ Select matched [${r.matchType}] score: ${r.score.toFixed(3)}`),!0):!1}function te(e,n){const o=m(n),t=["yes","true","1","checked","on"].includes(o);return e.checked!==t?(e.checked=t,e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("click",{bubbles:!0})),!0):!1}async function R(e,n){try{console.log("üìÑ Attempting to upload file to:",e);const o=await chrome.storage.local.get(["resumeBase64","resumePath"]);let t,r=n;if(o.resumeBase64){console.log("‚úÖ Using downloaded resume from API");const f=o.resumeBase64,a=atob(f),h=new Array(a.length);for(let d=0;d<a.length;d++)h[d]=a.charCodeAt(d);const p=new Uint8Array(h);if(t=new Blob([p],{type:"application/pdf"}),o.resumePath){const d=o.resumePath.split("/"),g=d[d.length-1];r=g.split(":")[1]||g||n}console.log("üìÑ Using filename:",r)}else{console.log("‚ö†Ô∏è No downloaded resume found, falling back to static Resume.pdf");const f=chrome.runtime.getURL("src/static/Resume.pdf"),a=await fetch(f);if(!a.ok)return console.error(`‚ùå Failed to fetch file: ${a.status}`),!1;t=await a.blob()}const l=new File([t],r,{type:"application/pdf"}),s=new DataTransfer;s.items.add(l),e.files=s.files;const i=["change","input","blur","focus"];i.forEach(f=>{e.dispatchEvent(new Event(f,{bubbles:!0}))});let c=e.parentElement,u=0;for(;c&&u<3;)i.forEach(f=>{c.dispatchEvent(new Event(f,{bubbles:!0}))}),c=c.parentElement,u++;return console.log(`‚úÖ File uploaded successfully: ${r}`),!0}catch(o){return console.error("‚ùå Error uploading file:",o),!1}}function F(e,n){const o=n.split(".").reduce((t,r)=>{if(t==null)return;if(t[r]!==void 0)return t[r];const l=r.toLowerCase();for(const s in t)if(s.toLowerCase()===l)return t[s]},e);return o!=null?String(o):void 0}async function oe(){console.log(`
üéØ ============ FUZZY MATCHING START ============`),B();const n=(await chrome.storage.local.get("userData")).userData;if(!n)return console.error("‚ùå No user data found in storage"),{success:!1,filledCount:0,filledFields:[]};console.log("üì¶ User data loaded from storage"),console.log("   Available fields:",Object.keys(n).length);let o=0;const t=[],r=document.querySelectorAll("input, textarea"),l=document.querySelectorAll("select"),s=document.querySelectorAll('input[type="file"]');console.log(`
üìã Form fields detected:`),console.log("   - Text/Textarea inputs:",r.length),console.log("   - Select dropdowns:",l.length),console.log("   - File inputs:",s.length),console.log(`
üéØ FUZZY MATCHING - High Confidence Only (threshold: 0.75)`);const i=[];r.forEach(a=>{if(a.type==="hidden"||a.type==="submit"||a.type==="button"||a.type==="file")return;const h=w(a);if(h.length===0)return;const p=C(h,n);p&&i.push({element:a,labelHierarchy:h,matchedField:p.key,score:p.score,matchType:p.matchType})}),l.forEach(a=>{const h=w(a);if(h.length===0)return;const p=C(h,n);p&&i.push({element:a,labelHierarchy:h,matchedField:p.key,score:p.score,matchType:p.matchType})}),console.log(`
‚úÖ Found ${i.length} potential matches`),i.sort((a,h)=>{const p={exact:3,alias:2,fuzzy:1},d=p[a.matchType],g=p[h.matchType];return d!==g?g-d:h.score-a.score});const c=new Set;for(const a of i){if(c.has(a.matchedField))continue;const h=F(n,a.matchedField);if(!h)continue;let p=!1;const d=a.labelHierarchy[0]||"",g=k(a.element);if(a.element instanceof HTMLInputElement&&a.element.type==="checkbox"){const y=m(h),E=m(d),x=m(a.element.value);(E===y||x===y||A(E,y)>.7||A(x,y)>.7)&&(p=te(a.element,h))}else a.element instanceof HTMLSelectElement?p=ee(a.element,h):p=X(a.element,h);p?(console.log(`‚úÖ Fuzzy filled "${a.matchedField}" [${a.matchType}] [score: ${a.score.toFixed(3)}]:`,h.substring(0,50)),o++,t.push({selector:g,field:a.matchedField,score:a.score,matchType:a.matchType}),c.add(a.matchedField),v(a.element,!0,"fuzzy_match")):v(a.element,!1,"failed")}console.log(`
üì§ Checking file uploads...`);const u=new Set;for(const a of s){if(u.has(a)){console.log("‚è≠Ô∏è  Already filled this file input, skipping...");continue}const h=G(a),p=h.some(y=>J(y)),d=h.length>0?C(h,n,.5):null;if(console.log("üìé File input detected:"),console.log("   - Labels:",h.slice(0,3)),console.log("   - Has file keywords:",p),console.log("   - Match:",d?`${d.key} [${d.matchType}] score: ${d.score.toFixed(3)}`:"none"),p&&((d==null?void 0:d.key)==="resume"||(d==null?void 0:d.key)==="cv"||(d==null?void 0:d.key)==="resumefile"||(d==null?void 0:d.key)==="cvfile"||(d==null?void 0:d.key.includes("resume"))||(d==null?void 0:d.key.includes("cv"))||n.resume||n.cv)){const y=F(n,"resume")||F(n,"cv")||F(n,"links_and_documents_resume")||"Resume.pdf";if(await R(a,y)){u.add(a);const x=k(a);console.log(`‚úÖ Fuzzy uploaded file [${(d==null?void 0:d.matchType)||"auto"}] [score: ${(d==null?void 0:d.score.toFixed(3))||"auto"}]`),o++,t.push({selector:x,field:(d==null?void 0:d.key)||"resume",score:(d==null?void 0:d.score)||.9,matchType:(d==null?void 0:d.matchType)||"fuzzy"}),v(a,!0,"fuzzy_match")}else v(a,!1,"failed")}else p&&v(a,!1,"failed")}console.log(`
‚úÖ ============ FUZZY MATCHING COMPLETE ============`),console.log(`   Fields filled: ${o}`),console.log(`   - Exact matches: ${t.filter(a=>a.matchType==="exact").length}`),console.log(`   - Alias matches: ${t.filter(a=>a.matchType==="alias").length}`),console.log(`   - Fuzzy matches: ${t.filter(a=>a.matchType==="fuzzy").length}`),console.log(`   Success: ${o>0}`),z();const f=q();return{success:o>0,filledCount:o,filledFields:t,trackingData:f}}function ne(e){var s,i;const n=[],o=[],t=se(e);t.length>0?n.push(...t):document.querySelectorAll('form, fieldset, [role="group"], [class*="section"], [class*="form-group"]').forEach(u=>{const f=U(u,e);f&&(f.fields.length>0||f.subsections.length>0)&&n.push(f)});const r=ce(e);r.length>0&&n.push({heading:"Other Fields",fields:r,subsections:[]});function l(c){o.push(...c.fields),c.subsections.forEach(l)}return n.forEach(l),{url:window.location.href,title:document.title,timestamp:new Date().toISOString(),sections:n,allFields:o,metadata:{totalFields:o.length,requiredFields:o.filter(c=>c.isRequired).length,emptyFields:o.filter(c=>c.isEmpty&&c.should_fill).length,formAction:(s=document.querySelector("form"))==null?void 0:s.action,formMethod:(i=document.querySelector("form"))==null?void 0:i.method}}}function U(e,n){const o=le(e),t=[],r=[],l=e.querySelectorAll("input, select, textarea");return Array.from(l).filter(c=>c.closest('form, fieldset, [role="group"], [class*="section"], [class*="form-group"]')===e).forEach(c=>{const u=M(c,n);u&&t.push(u)}),Array.from(e.querySelectorAll('fieldset, [role="group"]')).filter(c=>{var f;return((f=c.parentElement)==null?void 0:f.closest('form, fieldset, [role="group"]'))===e}).forEach(c=>{const u=U(c,n);u&&r.push(u)}),t.length===0&&r.length===0?null:{heading:o,fields:t,subsections:r}}function M(e,n){var c,u,f,a;if(e.type==="hidden"||e.type==="submit"||e.type==="button")return null;const o=k(e);if(n.has(o))return{selector:o,id:e.id,name:e.name,type:e.type||e.tagName.toLowerCase(),inputType:e instanceof HTMLInputElement?e.type:void 0,labels:{directLabel:I(e),fieldsetLabel:L(e),groupLabel:T(e)},value:e instanceof HTMLSelectElement?e.value:e instanceof HTMLInputElement&&(e.type==="checkbox"||e.type==="radio")?e.checked:e instanceof HTMLInputElement&&e.type==="file"?((u=(c=e.files)==null?void 0:c[0])==null?void 0:u.name)||null:e.value,isEmpty:!1,isRequired:e.hasAttribute("required"),filled_by:"fuzzy_matching"};const r={directLabel:I(e),fieldsetLabel:L(e),groupLabel:T(e),placeholder:"placeholder"in e?e.placeholder:void 0,ariaLabel:e.getAttribute("aria-label")||void 0,precedingLabels:re(e),contextText:ie(e)};let l,s;if(e instanceof HTMLSelectElement){l=e.value;const h=[],p=[];Array.from(e.options).forEach(d=>{var y;const g=[d.value,((y=d.textContent)==null?void 0:y.trim())||""];d.selected?p.push(g):h.push(g)}),s={unselected:h,selected:p.length>0?p:null}}else e instanceof HTMLInputElement?e.type==="checkbox"||e.type==="radio"?l=e.checked:e.type==="file"?l=((a=(f=e.files)==null?void 0:f[0])==null?void 0:a.name)||null:l=e.value:l=e.value;const i=!l||l===""||typeof l=="boolean"&&!l;return{selector:o,id:e.id,name:e.name,type:e.type||e.tagName.toLowerCase(),inputType:e instanceof HTMLInputElement?e.type:void 0,labels:r,value:l,isEmpty:i,isRequired:e.hasAttribute("required"),options:s,validation:{pattern:e.getAttribute("pattern")||void 0,minLength:e.getAttribute("minlength")?parseInt(e.getAttribute("minlength")):void 0,maxLength:e.getAttribute("maxlength")?parseInt(e.getAttribute("maxlength")):void 0,min:e.getAttribute("min")||void 0,max:e.getAttribute("max")||void 0},should_fill:i}}function k(e){if(e.id)return`#${e.id}`;if("name"in e&&e.name)return`[name="${e.name}"]`;let n=e.tagName.toLowerCase();if(e.className){const t=Array.from(e.classList).filter(r=>r&&!r.includes(" "));t.length>0&&(n+=`.${t.join(".")}`)}const o=e.parentElement;if(o){const r=Array.from(o.children).indexOf(e);n+=`:nth-child(${r+1})`}return n}function I(e){var o;if(e.id){const t=document.querySelector(`label[for="${e.id}"]`);if(t!=null&&t.textContent){const r=t.textContent.trim();if(r)return r}}const n=e.closest("label");if(n){const t=n.cloneNode(!0),r=t.querySelector("input, select, textarea");r&&r.remove();const l=(o=t.textContent)==null?void 0:o.trim();if(l)return l}}function L(e){const n=e.closest("fieldset");if(n){const o=n.querySelector(":scope > legend");if(o!=null&&o.textContent){const t=o.textContent.trim();if(t)return t}}}function T(e){const n=e.closest('[role="group"]');if(n){const o=n.getAttribute("aria-label");if(o)return o;const t=n.getAttribute("aria-labelledby");if(t){const r=document.getElementById(t);if(r!=null&&r.textContent){const l=r.textContent.trim();if(l)return l}}}}function re(e){var l;const n=[],o=e.closest('form, fieldset, [role="group"], [class*="form"]');if(!o)return;const t=Array.from(o.querySelectorAll('label, h1, h2, h3, h4, h5, h6, [class*="label"], [class*="heading"], [class*="title"]'));if(Array.from(o.querySelectorAll("input, select, textarea")).indexOf(e)!==-1){for(const s of t){const i=Array.from(o.querySelectorAll("*")).indexOf(s),c=Array.from(o.querySelectorAll("*")).indexOf(e);if(i<c){const u=(l=s.textContent)==null?void 0:l.trim();u&&u.length>0&&u.length<200&&!u.includes(`

`)&&n.push(u)}}return n.length>0?n.slice(-5):void 0}}function ie(e){var l;const n=e.parentElement;if(!n)return;const o=n.cloneNode(!0);o.querySelectorAll("input, select, textarea, button").forEach(s=>s.remove());const r=(l=o.textContent)==null?void 0:l.trim();if(r&&r.length>0&&r.length<300)return r}function le(e){const n=e.querySelector(":scope > legend");if(n!=null&&n.textContent){const i=n.textContent.trim();if(i)return i}const o=e.querySelector(":scope > h1, :scope > h2, :scope > h3, :scope > h4, :scope > h5, :scope > h6");if(o!=null&&o.textContent){const i=o.textContent.trim();if(i)return i}const t=e.querySelector(':scope > .form-label, :scope > .section-title, :scope > [class*="heading"]');if(t!=null&&t.textContent){const i=t.textContent.trim();if(i)return i}const r=e.getAttribute("aria-label");if(r)return r;const l=e.getAttribute("aria-labelledby");if(l){const i=document.getElementById(l);if(i!=null&&i.textContent){const c=i.textContent.trim();if(c)return c}}const s=e.id;if(s){const i=document.querySelector(`[for="${s}"]`);if(i!=null&&i.textContent){const c=i.textContent.trim();if(c)return c}}return"Unnamed Section"}function se(e){const n=[],o=['[data-type="control_head"]',"h1, h2, h3, h4, h5, h6",'[class*="header"]','[class*="section-title"]','[id*="header"]',"legend",'[role="heading"]'],t=document.querySelectorAll(o.join(", ")),r=new Set;return t.forEach((l,s)=>{const i=H(l);if(!i||i==="Unnamed Section")return;const c=[];let u=null;for(let g=s+1;g<t.length;g++){const y=t[g],E=H(y);if(E&&E!=="Unnamed Section"){u=y;break}}const f=l.closest("form")||document.body,a=Array.from(f.querySelectorAll("input, select, textarea")),h=Array.from(f.querySelectorAll("*")),p=h.indexOf(l),d=u?h.indexOf(u):1/0;a.forEach(g=>{if(r.has(g))return;const y=h.indexOf(g);if(y>p&&y<d){const E=M(g,e);E&&(c.push(E),r.add(g))}}),c.length>0&&n.push({heading:i,fields:c,subsections:[]})}),n}function H(e){if(e.hasAttribute("data-type")&&e.getAttribute("data-type")==="control_head"){const o=e.querySelector('h1, h2, h3, h4, h5, h6, [class*="header"], [class*="form-header"]');if(o!=null&&o.textContent){const t=o.textContent.trim();if(t)return t}}if(e.textContent){const o=e.textContent.trim();if(o&&o.length>0&&o.length<200)return o}const n=e.getAttribute("aria-label");return n||""}function ce(e){const n=[];return document.querySelectorAll("input, select, textarea").forEach(t=>{if(!t.closest('form, fieldset, [role="group"], [class*="form-group"]')){const l=M(t,e);l&&n.push(l)}}),n}function ae(e){return e.type!=="radio"?!1:(e.name&&document.querySelectorAll(`input[type="radio"][name="${e.name}"]`).forEach(o=>{o!==e&&o.checked&&(o.checked=!1,o.dispatchEvent(new Event("change",{bubbles:!0})))}),e.checked?!1:(e.checked=!0,e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("click",{bubbles:!0})),!0))}function ue(e,n){if(!e.multiple)return!1;let o=!1;return Array.from(e.options).forEach(t=>{t.selected&&(t.selected=!1,o=!0)}),n.forEach(t=>{const r=m(t);for(let l=0;l<e.options.length;l++){const s=e.options[l],i=m(s.textContent||""),c=m(s.value);if(i===r||c===r||i.includes(r)||r.includes(i)){s.selected=!0,o=!0;break}}}),o?(e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("blur",{bubbles:!0})),!0):!1}function de(e,n){if(e.type!=="date")return!1;let o=n;if(n.includes("/")){const t=n.split("/");t.length===3&&(t[2].length===4?o=`${t[2]}-${t[1].padStart(2,"0")}-${t[0].padStart(2,"0")}`:t[0].length===4&&(o=`${t[0]}-${t[1].padStart(2,"0")}-${t[2].padStart(2,"0")}`))}return e.value=o,e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),e.dispatchEvent(new Event("blur",{bubbles:!0})),!0}function D(e,n){if(e.type!=="number")return!1;const o=parseFloat(e.value)||0,t=parseFloat(e.step)||1,r=e.min?parseFloat(e.min):-1/0,l=e.max?parseFloat(e.max):1/0;let s=n==="increment"?o+t:o-t;return s=Math.max(r,Math.min(l,s)),e.value=s.toString(),e.dispatchEvent(new Event("input",{bubbles:!0})),e.dispatchEvent(new Event("change",{bubbles:!0})),!0}async function fe(e){let n=0,o=0;const t=[];try{const r=JSON.parse(e);if(!r.actions||!Array.isArray(r.actions))throw new Error('Invalid JSON: "actions" array not found');console.log(`ü§ñ Executing ${r.actions.length} AI actions...`);for(const s of r.actions)try{if(["fill","select","check","upload_file","select_multiple","fill_date"].includes(s.action)&&(s.value===null||s.value==="string"||s.value==="null")){console.log(`‚è≠Ô∏è  Skipping action for ${s.selector} - value is ${s.value===""?"empty string":"null/undefined"}`),o++;continue}const i=document.querySelector(s.selector);if(!i){const u=`Element not found: ${s.selector}`;console.warn(`‚ö†Ô∏è ${u}`),t.push(u),o++;continue}let c=!1;switch(s.action){case"fill":(i instanceof HTMLInputElement||i instanceof HTMLTextAreaElement)&&(i.value=String(s.value),i.dispatchEvent(new Event("input",{bubbles:!0})),i.dispatchEvent(new Event("change",{bubbles:!0})),i.dispatchEvent(new Event("blur",{bubbles:!0})),c=!0);break;case"select":i instanceof HTMLSelectElement&&(i.value=String(s.value),i.dispatchEvent(new Event("change",{bubbles:!0})),i.dispatchEvent(new Event("blur",{bubbles:!0})),c=!0);break;case"check":i instanceof HTMLInputElement&&(i.type==="checkbox"||i.type==="radio")&&(i.checked=!0,i.dispatchEvent(new Event("change",{bubbles:!0})),i.dispatchEvent(new Event("click",{bubbles:!0})),c=!0);break;case"uncheck":i instanceof HTMLInputElement&&i.type==="checkbox"&&(i.checked=!1,i.dispatchEvent(new Event("change",{bubbles:!0})),i.dispatchEvent(new Event("click",{bubbles:!0})),c=!0);break;case"click":i.click(),c=!0;break;case"upload_file":i instanceof HTMLInputElement&&i.type==="file"&&(c=await R(i,String(s.value)));break;case"radio_select":i instanceof HTMLInputElement&&i.type==="radio"&&(c=ae(i));break;case"select_multiple":if(i instanceof HTMLSelectElement&&i.multiple){const u=Array.isArray(s.value)?s.value:[s.value];c=ue(i,u)}break;case"fill_date":i instanceof HTMLInputElement&&i.type==="date"&&(c=de(i,String(s.value)));break;case"spin_increment":i instanceof HTMLInputElement&&i.type==="number"&&(c=D(i,"increment"));break;case"spin_decrement":i instanceof HTMLInputElement&&i.type==="number"&&(c=D(i,"decrement"));break}if(c)console.log(`‚úÖ ${s.action} on ${s.selector}:`,s.value,s.reasoning||""),n++,v(i,!0,"ai_autofill");else{const u=`Failed to execute ${s.action} on ${s.selector}`;t.push(u),o++,v(i,!1,"failed")}}catch(i){const c=`Error executing action on ${s.selector}: ${i}`;console.error(`‚ùå ${c}`),t.push(c),o++}console.log(`
üìä Execution complete: ${n} success, ${o} failed`),z();const l=q();return{success:n,failed:o,errors:t,trackingData:l}}catch(r){const l=`Failed to parse JSON: ${r}`;return console.error(`‚ùå ${l}`),t.push(l),{success:0,failed:0,errors:t,trackingData:[]}}}chrome.runtime.onMessage.addListener((e,n,o)=>{var t,r,l;if(console.log(" Message received:",e.action),e.action==="countFormFields"){console.log("Counting form fields...");const i=document.querySelectorAll('input:not([type="hidden"]):not([type="submit"]):not([type="button"]), textarea, select').length;return console.log(`Total fields detected: ${i}`),o({totalFields:i}),!0}if(e.action==="fuzzyMatchOnly")return console.log(" Starting fuzzy matching..."),oe().then(s=>{console.log("‚úÖ Fuzzy match complete:",s),console.log(" Sending response:",{success:s.success,filledCount:s.filledCount,filledFieldsCount:s.filledFields.length}),o(s)}),!0;if(e.action==="captureForAI"){console.log(" Capturing form snapshot for AI..."),console.log("   Filled selectors received:",((t=e.filledSelectors)==null?void 0:t.length)||0);const s=new Set(e.filledSelectors||[]),i=ne(s);return console.log("‚úÖ Snapshot captured:"),console.log("   - Total fields:",i.allFields.length),console.log("   - Empty fields to fill:",i.metadata.emptyFields),console.log("   - Required fields:",i.metadata.requiredFields),console.log("   - Sections:",i.sections.length),console.log(" Full snapshot (first 3 fields only):"),i.allFields.slice(0,3).forEach((c,u)=>{console.log(`   Field ${u+1}:`,{selector:c.selector,type:c.type,labels:c.labels.directLabel||c.labels.placeholder||"no label",isEmpty:c.isEmpty,filled_by:c.filled_by,should_fill:c.should_fill})}),console.log(" Sending snapshot to popup..."),o({snapshot:i}),!0}if(e.action==="executeAIActionsFromJSON"){console.log(" Received AI actions to execute"),console.log(" Raw JSON payload:"),console.log(e.actionsJSON);try{const s=JSON.parse(e.actionsJSON);console.log("‚úÖ Parsed successfully:"),console.log("   - Number of actions:",((r=s.actions)==null?void 0:r.length)||0),console.log("   - First 3 actions:"),(l=s.actions)==null||l.slice(0,3).forEach((i,c)=>{var u;console.log(`      Action ${c+1}:`,{selector:i.selector,action:i.action,value:i.value,reasoning:((u=i.reasoning)==null?void 0:u.substring(0,50))+"..."})})}catch(s){console.error("‚ùå Failed to parse JSON:",s)}return fe(e.actionsJSON).then(s=>{console.log("‚úÖ AI actions execution complete:"),console.log("   - Success:",s.success),console.log("   - Failed:",s.failed),console.log("   - Errors:",s.errors),console.log(" Sending execution result back to popup..."),o(s)}),!0}if(e.action==="getFieldTracking")return console.log(" Getting field tracking data..."),z(),console.log("‚úÖ Returning field tracking data:",b.length,"fields"),o({trackingData:b}),!0;console.warn("‚ö†Ô∏è Unknown action:",e.action)});
